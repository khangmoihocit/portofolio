@use '../abstracts/variables' as *;
@use '../abstracts/mixins' as *;

@keyframes pulse {
    0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(var(--color-green-rgb), 0.7);
    }
    70% {
        transform: scale(1);
        box-shadow: 0 0 0 10px rgba(var(--color-green-rgb), 0);
    }
    100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(var(--color-green-rgb), 0);
    }
}

@keyframes fadeIn-slideUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

// Keyframe cho con trỏ nhấp nháy
@keyframes blink-caret {
    from,
    to {
        border-color: transparent;
    }
    50% {
        border-color: var(--color-navy);
    }
}

.fab-menu {
    position: fixed;
    bottom: 100px;
    right: $spacing-md;
    z-index: $z-index-dropdown;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: $spacing-sm;

    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
    transition: opacity $transition-medium, transform $transition-medium,
        visibility $transition-medium;

    &.visible {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    // --- BONG BÓNG CHAT NHỎ ---
    &__popup-bubble {
        position: absolute;
        bottom: 120%; // Tăng khoảng cách để có chỗ cho "đuôi"
        right: 0;
        background-color: var(--color-green);
        color: var(--color-navy);
        padding: $spacing-sm $spacing-md;
        border-radius: $border-radius-lg;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        font-size: $font-size-small;
        font-weight: 500;
        white-space: nowrap;
        animation: fadeIn-slideUp 0.5s ease-out forwards;
        pointer-events: none;

        &::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 15px;
            width: 0;
            height: 0;
            border: 10px solid transparent;
            border-top-color: var(--color-green);
            border-bottom: 0;
            border-right: 0;
            margin-left: -5px;
        }
    }

    .typing-text {
        display: inline-block;
        border-right: 0.15em solid var(--color-navy); // Con trỏ nhấp nháy
        white-space: nowrap;
        overflow: hidden;
        animation: blink-caret 0.75s step-end infinite;
    }

    &__button-wrapper {
        position: relative;
        border-radius: 50%;
        animation: pulse 2s infinite cubic-bezier(0.66, 0, 0, 1);
    }

    // Nút con chung
    &__button {
        @include button-reset;
        @include flex-center;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        color: white;
        font-size: 22px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        transition: transform $transition-fast, box-shadow $transition-fast,
            opacity $transition-fast, visibility $transition-fast;

        &:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }
    }

    &__button--chatbot {
        background-color: var(--color-green);
        color: var(--color-navy);
    }

    &__button--zalo {
        background-color: #0068ff;
    }

    &__button--messenger {
        img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }
    }
}

// ---- Giao diện TABLET trở lên ----
// Áp dụng cho màn hình từ 768px trở lên
@include tablet {
    .fab-menu {
        bottom: $spacing-xl;
        right: $spacing-xl;
        gap: $spacing-md;

        &__button {
            width: 50px;
            height: 50px;
            font-size: $font-size-large;
        }
    }
}

@include mobile {
    .fab-menu {
        bottom: 100px;
        right: 5px;
        gap: $spacing-sm;

        &__button {
            width: 50px;
            height: 50px;
            font-size: $font-size-base;
        }
    }
}

// ---- Chatbot Container Styling ----

.chatbot-container {
    position: fixed;
    // Vị trí sẽ nằm ngay trên các nút FAB
    bottom: calc(#{$spacing-xl} + 100px + #{$spacing-md});
    right: $spacing-xl;
    z-index: $z-index-dropdown;

    // Hiệu ứng xuất hiện mượt mà
    opacity: 0;
    transform: translateY(20px);
    animation: fadeIn 0.3s ease forwards;

    // Khi chatbot ở chế độ fullscreen, container không được giới hạn
    &--fullscreen {
        position: static !important;
        bottom: auto !important;
        right: auto !important;
        left: auto !important;
        top: auto !important;
        width: auto !important;
        height: auto !important;
        transform: none !important;
        animation: none !important;
        opacity: 1 !important;
        transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
}

@keyframes fadeIn {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

// ---- Responsive cho Mobile ----
@include mobile {
    .chatbot-container {
        bottom: 160px;
        right: $spacing-md;
        left: $spacing-md;

        //full-width trên mobile
        .chatbot-widget {
            width: 100%;
        }
    }
}
